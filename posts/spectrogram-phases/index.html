<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="There was a tweet recently pointing out the apparent structurelessness of the phase data that is usually discarded when you compute audio spectrograms. People familiar with audio will know phase is important so this is pretty weird. So here&rsquo;s quick post about what makes the phases so bad and some tricks to show there is structure to be found in them, but no promises any of it will be useful.">
<meta property="og:title" content="Spectrogram Phases">
<meta property="og:description" content="There was a tweet recently pointing out the apparent structurelessness of the phase data that is usually discarded when you compute audio spectrograms. People familiar with audio will know phase is important so this is pretty weird. So here&rsquo;s quick post about what makes the phases so bad and some tricks to show there is structure to be found in them, but no promises any of it will be useful.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://graemephi.github.io/posts/spectrogram-phases/"><meta property="og:image" content="https://graemephi.github.io/posts/spectrogram-phases/thumbnail.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2025-09-28T19:44:32+01:00">
<meta property="article:modified_time" content="2025-09-28T19:44:32+01:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://graemephi.github.io/posts/spectrogram-phases/thumbnail.png">
<meta name=twitter:title content="Spectrogram Phases">
<meta name=twitter:description content="There was a tweet recently pointing out the apparent structurelessness of the phase data that is usually discarded when you compute audio spectrograms. People familiar with audio will know phase is important so this is pretty weird. So here&rsquo;s quick post about what makes the phases so bad and some tricks to show there is structure to be found in them, but no promises any of it will be useful.">
<meta name=twitter:site content="@graemephi">
<meta name=generator content="Hugo 0.90.0-DEV">
<title>Spectrogram Phases - graeme. hello</title>
<link href=/css/katex.min.css rel=stylesheet type=text/css>
<style>body{background-color:#fffdfc;font-family:Georgia,times new roman,serif;font-size:1em;margin:0 2em;line-height:1.4em}body *{margin-left:auto;margin-right:auto}a.footnote-backref{visibility:hidden;font-size:.66em}a.footnote-backref::before{visibility:visible;content:"back"}.content{width:42em}@media(max-width:49.1228em){.content{width:85vw}}.about{margin:0}.page-header{align-items:center;display:flex;justify-content:space-between}.name{margin-left:1em;margin-right:auto}.post-header{align-items:baseline;color:#5a5857;display:flex;flex-flow:wrap;justify-content:space-between;line-height:.5em}a{color:#000;text-decoration-color:#5a5857;text-decoration:underline}a:hover{color:#ffa000;text-decoration-color:#d18400}.icon:hover{fill:#ffa000}h1>a,h2>a,h3>a,h4>a,a.icon{text-decoration:none}hr{border:0;height:0;border-top:1px solid rgba(87,44,0,.1)}.svgi>svg{vertical-align:middle}code{font-family:consolas;font-size:.8em;overflow-x:scroll;max-width:100%}.tags{align-items:baseline;color:#5a5857;display:flex;flex-flow:wrap;line-height:1em;list-style-type:none;padding:0}.tags.post-tags{font-size:.9em;justify-content:flex-end;margin:0}.tags.all-tags{justify-content:flex-start;margin:-1em 0}.list-tags{margin:-1em 0}.tags a{color:#2d2c2b}.post-tags a{text-decoration:none}.tags>li{margin:0 .1em}.post{margin:2em auto}.post img{display:block;margin:0 auto;max-width:calc(100vw - 1em);height:auto}.text-align-right{text-align:right}.rss-link{font-size:.8em;text-align:right}.post-title{line-height:1em}.katex{font-size:large}pre.terminal,pre>code.language-terminal{background:#272822;padding:.66em 1em;padding:1em 2em;margin:1em -1em;color:#f8f8f2;display:block;border-radius:5px}p code{background:#feeee7;padding:.1em .2em}.katex-display>.katex{font-size:larger}.highlight>pre{position:relative;padding:1em 2em;margin:1em -1em;overflow-x:auto}.highlight code{font-size:.83em}.img-flex{background-color:#fffdfc;display:flex;justify-content:center;flex-wrap:wrap;position:relative;width:100vw;left:calc(50% - 50vw)}.img-flex>img{margin:.5em}@media(min-width:84em){.img-flex{width:84em;left:calc(50% - 42em)}}.katex-display>.katex{max-width:100%;overflow-x:scroll}table{margin:1em -1em;border-collapse:separate;border-spacing:0;border-radius:5px;width:calc(100% + 2em);overflow-x:scroll;border:1px solid hsla(20,58%,46%,.2)}th,td{padding:.5em 1em;border-right:1px solid hsla(20,58%,46%,.1)}th{font-weight:700;border-bottom:1px solid hsla(20,58%,46%,.1);background-color:#fbf3ef;text-align:left}td{border-bottom:1px solid hsla(20,58%,46%,.1)}tr:last-child td{border-bottom:none}td:last-child,th:last-child{border-right:none}blockquote{padding:.5em 1.5em;margin:1em .5em;display:block;border-radius:0;background-color:transparent;border-left:3px solid hsla(20,58%,46%,12%);position:relative}blockquote p:first-of-type{margin-top:0}blockquote p:last-of-type{margin-bottom:0}blockquote cite{display:block;font-style:normal;font-size:.9em;text-align:right;margin-top:.5em;color:#272625}blockquote.aside{padding:1em 1.5em;margin:1em -1em;display:block;border-radius:5px;background-color:#fbf3ef;border-style:outset;border-color:hsla(20,58%,46%,4%)}p{margin-bottom:1.1em}.content p,.post p,blockquote p{line-height:1.45em}a{text-decoration-thickness:1px;text-underline-offset:2px}h1,h2,h3,h4{margin-top:1.5em;margin-bottom:.7em;line-height:1.2}p,li,blockquote{letter-spacing:.01em}</style>
</head>
<body>
<div class=content>
<header class=page-header>
<span style=display:inline-flex;flex-direction:column>
<h3 class=page-title><a href=/><span>graeme. hello</span></a></h3>
</span>
<span class=links>
<a href=https://github.com/graemephi class="github icon" title=Github><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
</a>
<a href=https://mastodon.gamedev.place/@graeme class="mastodon icon" title=Mastodon><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 418 512" fill="currentcolor" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
</a>
</span>
</header>
<div class=post-header>
<h1 class=post-title><a href=/posts/spectrogram-phases/>Spectrogram Phases</a></h1>
</div>
<div class=text-align-right>
<span class=date>September 28, 2025</span>
<br>
<ul class="tags post-tags">
[
<li><a href=/tags/audio/>audio</a>,</li>
<li><a href=/tags/dsp/>dsp</a></li>
]
</ul>
</div>
<div class=post>
<p>There was <a href=https://x.com/_lyraaaa_/status/1970803097686736916>a tweet recently</a> pointing out the apparent structurelessness of the phase data that is usually discarded when you compute audio spectrograms. People familiar with audio will know phase is important so this is pretty weird. So here&rsquo;s quick post about what makes the phases so bad and some tricks to show there is structure to be found in them, but no promises any of it will be useful.</p>
<p>I&rsquo;m going to use <a href="https://www.youtube.com/watch?v=YhRybYyrNaI">this track</a> for all the plots in this post. It has a bunch of big long chirps and even a big block of pink noise at the end. Don&rsquo;t ask me. I think you can see someone turning the knob on a filter sweep as well.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/01_hann.png width=829 height=888 loading=lazy>
</div>
<p>The phases basically just looks like noise. By the way, it&rsquo;s all grey, even though there is no grey in the color map, because I&rsquo;m telling matplotlib to do the downsampling in color space. Averaging phases does the wrong thing. Phases are periodic and I&rsquo;m too lazy to figure out a better way to downsample this data for display. A color off the color map is way less deceiving than a color on the color map, I think.</p>
<h2 id=1>1</h2>
<p>If you don&rsquo;t window at all (actually a rectangular window) a bunch of structure appears in the phases. But we introduced a discontinuity at the boundaries so there&rsquo;s loads of bogus high frequencies. Presumably some of this new phase structure is also bogus and just whatever it has to be to place a jump discontinuity between the first and last sample.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/02_rectangular.png width=829 height=888 loading=lazy>
</div>
<p>Here&rsquo;s the big brain response to this, which I got from a Miller Puckette paper. This is for Hann (raised cosine) windows. You can observe, empirically, two things. First is that when you take the DFT of a pure tone then the phase of the whole thing jumps by <span class=katex><span class=katex-mathml><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>π</span></span></span></span> at the bin the tone is in. Second is that when you window this tone the phase now jumps twice, back and forth. So you say okay, if a bin is actually responding to a tone, then probably its adjacent bins have totally opposite phase. So, as complex numbers, they&rsquo;re pointing in the opposite direction, and you can get a better estimate of the phase by flipping them and averaging. This is just</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>X <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>fft<span style=color:#f92672>.</span>rfft(x <span style=color:#f92672>*</span> window)
X[<span style=color:#ae81ff>1</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>-=</span> X[:<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> X[<span style=color:#ae81ff>2</span>:]
</code></pre></div><p>because we don&rsquo;t care about their magnitudes. In the context of phase vocoders this really works which is kind of fucked up, because if we actually now look at the phases it looks like nothing has changed.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/03_hann_puckette.png width=823 height=438 loading=lazy>
</div>
<p>But if we diff these two images we get this. So there&rsquo;s definitely some legible structure in there.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/04_hann_puckette_diff.png width=823 height=438 loading=lazy>
</div>
<p>Another thing you can do is just taper the edges of the rectangular window, here I&rsquo;m just doing 10 cosine samples at either end of a 8192 window. This kills off the high frequencies, which you can see by just eyeballing the spectrogram, but presumably still has all the problems rectangular windows have in terms of sidelobe fall off and whatever else.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/05_almost_box.png width=829 height=888 loading=lazy>
</div>
<p>It&rsquo;s removed all those big streaks, so probably they really were bogus. Apparently this is called a <a href=https://en.wikipedia.org/wiki/Window_function#Tukey_window>Tukey window</a>.</p>
<h2 id=2>2</h2>
<p>Phases are relative. The way to understand this is that if you slide a signal around in time all the phases update (at different rates, even), but audio sounds the same no matter when you hit play.</p>
<p>I&rsquo;m going to suggest defining phases relative to the phase in same bin in the last window, as phase deltas. I think you should be a little suspicious about this because we do actually care about the vertical phase structure and this will give every bin its own zero phase reference angle, making phases within a single window independent of each other. I don&rsquo;t think this matters too much as its easy to recover a shared-reference phase in context, and in cases where the phase is not just noise I think the vertical structure is probably pretty stable from step to step. So let&rsquo;s just do it. I&rsquo;m using the Tukey window here.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/06_diff_unwrap.png width=823 height=438 loading=lazy>
</div>
<p>That&rsquo;s a lot of structure. To get this I unwrapped the phases and computed deltas, both along the time dimension:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Xs : shape (window, bin)</span>
phases <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>angle(Xs)
phase_deltas <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>diff(np<span style=color:#f92672>.</span>unwrap(phases, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>), prepend<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</code></pre></div><p>The horizontal banding is pretty weird. This happens because higher bins' phases advance faster than lower bins, so their deltas are just bigger. We can get a normalized representation by dividing out the rate at which the sine under that bin advances:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>n <span style=color:#f92672>=</span> len(window)
dt <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> <span style=color:#ae81ff>4</span> <span style=color:#75715e># spectrogram step size</span>
normalized_frequencies <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>linspace(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, n<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
phase_normalizer <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>angle(np<span style=color:#f92672>.</span>exp(<span style=color:#ae81ff>2</span>j <span style=color:#f92672>*</span> np<span style=color:#f92672>.</span>pi <span style=color:#f92672>*</span> normalized_frequencies <span style=color:#f92672>*</span> dt))

<span style=color:#75715e># ...</span>
normalized_phase_deltas <span style=color:#f92672>=</span> phase_deltas <span style=color:#f92672>/</span> phase_normalizer
</code></pre></div><p>And that looks like this. Please ignore the incorrect units.</p>
<div style=display:flex;justify-content:center>
<img src=/posts/spectrogram-phases/07_normalized_diff_unwrap.png width=823 height=438 loading=lazy>
</div>
<p>You can see chirps in the phase plot now. This is pretty closely related to <a href=https://en.wikipedia.org/wiki/Instantaneous_phase_and_frequency>instantaneous frequency</a> but I don&rsquo;t think I&rsquo;ve ever seen it normalized this way. Someone must have.</p>
<h2 id=end>End</h2>
<p>I&rsquo;m pretty dubious about this representation being of any use for machine learning. Maybe it would work if you never atan2 out the phase and kept it as a complex number (getting the phase delta is just a complex division). You definitely don&rsquo;t want to be taking the derivate through anything that wraps the way an Euler angle does.</p>
<p>I had a quick look at recent papers to see what ML people were doing here before yoloing this post out there. It doesn&rsquo;t seem like anybody is using STFT phases. <a href=https://github.com/facebookresearch/encodec>EnCodec</a>, at least, uses the real and imaginary parts of STFTs at multiple window sizes. That makes sense.</p>
</div>
<blockquote class=aside>
<noscript><p style=margin:auto>There might be <a href=https://utteranc.es>utteranc.es</a> comments here when javascript is on.</p></noscript>
<script src=https://utteranc.es/client.js repo=graemephi/graemephi.github.io issue-term=og:title theme=github-light crossorigin=anonymous async></script>
</blockquote>
<h2>More Posts</h2>
<ol reversed>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/twelve-tones/>Twelve tones are inescapable</a> (2025-03-31)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/unique-random-numbers/>Generating Unique Random Numbers</a> (2024-09-27)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/modular-forms/>WTF Are Modular Forms</a> (2024-03-25)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/some-low-discrepancy-noise-functions/>Some low discrepancy noise functions</a> (2022-08-10)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/difference-decay/>Difference Decay</a> (2021-12-29)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/stb_ds-string-interning/>stb_ds: string interning</a> (2020-08-27)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/deep-sky-object/>deep sky object</a> (2020-05-20)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/calculating-lod/>Calculating LOD</a> (2019-12-31)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/triangle-dft/>The Discrete Fourier Transform, But With Triangles</a> (2019-12-14)
</li>
<li style=list-style:none>
<a href=https://graemephi.github.io/posts/dumb-tricks-with-phase-inversion/>Dumb Tricks With Phase Inversion</a> (2019-06-02)
</li>
</ol>
<div class=rss-link>
<a href=/index.xml title=RSS>rss</a>
</div>
</div>
</body>
</html>